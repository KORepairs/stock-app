<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Inventory Add</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/app.css" />
  <style>
    .panel{background:var(--panel);border:1px solid var(--border);border-radius:12px;padding:14px}
    .log{background:#111;color:#0f0;border-radius:8px;padding:10px;min-height:44px;white-space:pre-wrap}
    .toolbar{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin:12px 0}
  </style>
</head>

<body>
  <div class="wrap">
    <aside id="sidebar"></aside>

    <main class="page">
      <h1>Inventory Add</h1>
      <p style="color:#666; margin-top:0">
        Enter a part number. If it already exists, quantity will increase and it will tell you the SKU.
        If it’s new, it will create a new SKU in the selected category.
      </p>

      <div class="panel">
        <div class="form-grid">
          <label for="category">Category</label>
          <select id="category">
            <option value="A">A</option>
            <option value="B">B</option>
            <option value="F">F</option>
            <option value="G">G</option>
            <option value="R">R</option>
            <option value="S">S</option>
          </select>

          <label for="code">Part Number</label>
          <input id="code" type="text" placeholder="e.g. AM001EF590" />

          <label for="quantity">Quantity to add</label>
          <input id="quantity" type="number" value="1" min="1" />

          <label for="notes">Notes</label>
          <input id="notes" type="text" placeholder="optional" />

          <div class="full">
            <label></label>
            <div class="row">
              <button id="submitBtn">Add / Update</button>
              <button id="clearBtn" type="button">Clear</button>
            </div>
          </div>
        </div>
      </div>

      <div class="panel" style="margin-top:14px">
        <h3 style="margin:0 0 8px">Result</h3>
        <pre class="log" id="out">Waiting…</pre>
      </div>
    </main>
  </div>


<script>
  const $ = (s) => document.querySelector(s);

  function show(obj) {
    // ✅ Prefer the simple message from the API
    if (obj && typeof obj === 'object' && obj.message) {
      $('#out').textContent = obj.message;
      return;
    }
    // fallback
    $('#out').textContent = typeof obj === 'string' ? obj : JSON.stringify(obj, null, 2);
  }

    async function addSmart() {
      const payload = {
        category: $('#category').value,
        code: $('#code').value.trim(),              // ✅ MUST be called "code"
        quantity: Number($('#quantity').value || 0),
        notes: $('#notes').value.trim() || null,
        onEbay: false
      };

      if (!payload.code) {
        show('Please enter a Part Number.');
        return;
      }

      try {
        const res = await fetch('/api/products/add-smart', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        const json = await res.json();
        show(json);


        // Optional: after success, clear fields and keep category
        if (res.ok) {
          $('#code').value = '';
          $('#quantity').value = 1;
          $('#notes').value = '';
          $('#code').focus();
        }
      } catch (err) {
        show('ERROR: ' + err.message);
      }
    }

    $('#submitBtn').addEventListener('click', addSmart);
    $('#clearBtn').addEventListener('click', () => {
      $('#code').value = '';
      $('#quantity').value = 1;
      $('#notes').value = '';
      $('#code').focus();
      show('Waiting…');
    });
  </script>

  <script src="/js/sidebar.js"></script>
</body>
</html>
